{"pageProps":{"frontmatter":{"title":"What’s up with Llama 3? Arena data analysis","author":"Lisa Dunlap, Evan Frick, Tianle Li, Isaac Ong, Joseph E. Gonzalez, Wei-Lin Chiang","date":"May 8, 2024","previewImg":"/images/blog/llama3/llama3_blog_cover.png"},"content":"\nOn April 18th, Meta released Llama 3, their newest open-weight large language model. Since then, Llama 3-70B has quickly risen to the top of the English [Chatbot Arena leaderboard](https://leaderboard.lmsys.org) with over 50,000 battles. This remarkable achievement by Meta is excellent news for the open-source community. In this blog post, we aim to provide more insight into why users rank Llama 3-70b on par with top-ranked models like GPT-4-Turbo, Gemini 1.5 Pro, and Claude 3 Opus.\n\n<br />\n\nWe investigate the following:\n1. What types of prompts are users asking? Do users prefer Llama 3 on certain types of prompts? \n2. How challenging are these prompts? Does the ranking change if the prompts are easier/harder?\n3. Are certain users or prompts overrepresented? Do duplicate prompts or rankings from a small number of users affect the win rate?\n4. Does Llama 3 have qualitative differences which make users like it more?\n\nWe focus on battles consisting of Llama 3-70b against 5 top-ranked models (claude-3-opus-20240229, gpt-4-0125-preview, gpt-4-1106-preview, gpt-4-turbo-2024-04-09, gemini-1.5-pro-0409-preview) and reach the following conclusions:\n1. Llama 3 beats other top-ranking models on open-ended writing and creative problems but loses on more close-ended math and coding problems.\n2. As prompts get harder, Llama 3’s win rate against top-tier models drops significantly.\n3. Deduplication or outliers do not significantly affect the win rate.\n4. Qualitatively, Llama 3’s outputs are friendlier and more conversational than other models, and these traits appear more often in battles that Llama 3 wins.\n\n<br/>\n<img src=\"/images/blog/llama3/topic_win_rate.png\" style=\"display:block; margin-top: auto; margin-left: auto; margin-right: auto; margin-bottom: auto; width: 85%\"></img>\n<p style=\"color:gray; text-align: center;\">Figure 1. Llama 3-70b's win rate (excluding ties) against top 5 models across prompt topics. * denotes that the category contains less than 50 battles.</p>\n\n\n\n## Analyzing win rate across different types of prompts\n\n**Topic Analysis.** We utilize an LLM labeler (Llama 3-70b) to categorize user prompts into a pre-established taxonomy of topics ([from Reka's paper](https://arxiv.org/pdf/2404.12387)) and visualize the win rate of Llama 3-70b against the other top models in Figure 1. We see that Llama 3’s win rate is highest for open-ended and creative tasks like brainstorming and writing, and lowest for more close-ended technical tasks like math and translation. Interestingly, Llama 3 achieves the highest win rate over data processing tasks which mainly consist of parsing and dataframe operations, but as this category has only 19 examples, this remains inconclusive. \n\n**Win Rate versus Prompt Difficulty.** We employ our [recently released pipeline](https://lmsys.org/blog/2024-04-19-arena-hard/) which scores the difficulty of prompts to determine how Llama 3 compares to the other top models as prompts get harder. We define a set of \"hardness\" criteria and use GPT-4-turbo to annotate each prompt from 0 to 7 to indicate how many of these criteria are satisfied (a higher score indicates a harder prompt). Our 7 criteria are:\n\n<table style=\"width:100%; border-collapse: collapse; border: 1px solid black;\">\n  <tr style=\"background-color: black; color: white;\">\n    <!-- <th style=\"border: 1px solid black; padding: 10px; text-align: left;\">7 Key \"Hardness\" Criteria</th> -->\n  </tr>\n  <tr>\n    <td style=\"border: 1px solid black; padding: 10px; text-align: left;\"><strong>1. Specificity:</strong> Does the prompt ask for a specific output?</td>\n  </tr>\n  <tr>\n    <td style=\"border: 1px solid black; padding: 10px; text-align: left;\"><strong>2. Domain Knowledge:</strong> Does the prompt cover one or more specific domains?</td>\n  </tr>\n  <tr>\n    <td style=\"border: 1px solid black; padding: 10px; text-align: left;\"><strong>3. Complexity:</strong> Does the prompt have multiple levels of reasoning, components, or variables?</td>\n  </tr>\n  <tr>\n    <td style=\"border: 1px solid black; padding: 10px; text-align: left;\"><strong>4. Problem-Solving:</strong> Does the prompt directly involve the AI to demonstrate active problem-solving skills?</td>\n  </tr>\n  <tr>\n    <td style=\"border: 1px solid black; padding: 10px; text-align: left;\"><strong>5. Creativity:</strong> Does the prompt involve a level of creativity in approaching the problem?</td>\n  </tr>\n  <tr>\n    <td style=\"border: 1px solid black; padding: 10px; text-align: left;\"><strong>6. Technical Accuracy:</strong> Does the prompt require technical accuracy in the response?</td>\n  </tr>\n  <tr>\n    <td style=\"border: 1px solid black; padding: 10px; text-align: left;\"><strong>7. Real-world Application:</strong> Does the prompt relate to real-world applications?</td>\n  </tr>\n</table>\n\nWe score 1000 battles against the top 3 models on the leaderboard and plot their win rates versus prompt score in Figure 2. We observe a significant drop in Llama 3's performance compared to the other top models, from a high 50% win rate to a low 40% win rate. We conclude that as more of these \"hardness\" criteria are met, Llama 3's win rate drop rapidly compared to other models. Note that these criteria may not be exhaustive, see [the blog](https://lmsys.org/blog/2024-04-19-arena-hard/) for further discussion.\n\n<img src=\"/images/blog/llama3/winrate-over-criteria.png\" style=\"display:block; margin-top: auto; margin-left: auto; margin-right: auto; margin-bottom: auto; width: 70%\"></img>\n<p style=\"color:gray; text-align: center;\">Figure 2. Several top models' win rate against the strongest 6 models over the intervals of number of key criteria satisfied. *English battles between strongest models: llama-3-70b-chat, claude-3-opus-20240229, gpt-4-0125-preview, gpt-4-1106-preview, gpt-4-turbo-2024-04-09, gemini-1.5-pro-api-0409-preview.</p>\n\n<img src=\"/images/blog/llama3/criteria_dist.png\" style=\"display:block; margin-top: auto; margin-left: auto; margin-right: auto; margin-bottom: auto; width: 50%\"></img>\n<p style=\"color:gray; text-align: center;\">Figure 3. The percentage of prompts with number of hardness criteria met in 3.5K sample of arena battles. We observe a significant portion of the battles are classified as hard (~27%).</p>\n\nWe can further analyze which types of prompts affect win rate by fitting a decision tree on the 7 binary columns representing if a given prompt has satisfied each of the criteria above. From this decision tree, we can segment prompts into criteria subsets such that Llama 3-70b-Instruct either performs very well or very poorly. The tree shown in Figure 4 shows us which subsets change the model’s win rate the most when conditioned on.\n\n<img src=\"/images/blog/llama3/dtree.svg\" style=\"display:block; margin-top: auto; margin-left: auto; margin-right: auto; margin-bottom: auto; width: 100%\"></img>\n<p style=\"color:gray; text-align: center;\">Figure 4. Llama 3-70b-Instruct's win rate conditioned on hierarchical prompt criteria subsets as fitted using a standard decision tree algorithm.</p>\n\nThe first thing to notice is that “Specificity” is the root node of the tree, suggesting that this criteria already divides Llama 3-70b-Instruct’s performance into its strengths and weaknesses.  It supports our initial findings above that Llama 3-70b-Instruct is stronger on open-ended prompts (not specific) rather than more objective tasks.  We can traverse further down the tree and see that Llama 3-70b-Instruct is quite strong on open-ended creative prompts (see the blue path), reaching around a 60% win rate against these top models.  Following the orange path, we notice that Llama 3-70b-Instruct has a much lower win rate against top models when answering specific reasoning-based prompts.\n\n## The effect of overrepresented prompts and judges\n\n**Effect of duplicate prompts.** Using fuzzy string matching, we find that ~9% (6658/7327) of the user prompts in battles between Llama 3 and the other top models are duplicates, and show in Table 1 that deduplication does not significantly affect Llama 3's win rate. \n\n<style>\nth {text-align: left, text-weight: bold}\ntd {text-align: left}\n</style>\n\n\n<br>\n<p style=\"color:gray; text-align: center;\">Table 1: Llama 3-70b battle stats.</p>\n<table style=\"display: flex; justify-content: center;\">\n<tbody>\n<tr>\n<th>Model</th> <th># battles</th> <th># battles no tie</th> <th># battles (dedup, no tie)</th> <th>Llama 3 win rate</th> <th>Llama 3 win rate (dedup, no tie)</th>\n</tr>\n<tr>\n<td>Claude 3 Opus</td> <td>1959</td> <td>1328</td> <td>1171</td> <td>51.28%</td> <td>51.58%</td>\n</tr>\n<tr>\n<td>Gemini 1.5</td> <td>2413</td> <td>1620</td> <td>1437</td> <td>50.06%</td> <td>49.48%</td>\n</tr>\n<tr>\n<td>GPT-4 0125</td> <td>1271</td> <td>881</td> <td>779</td> <td>48.58%</td> <td>49.04%</td>\n</tr>\n<tr>\n<td>GPT-4 1106</td> <td>526</td> <td>349</td> <td>307</td> <td>50.72%</td> <td>52.12%</td>\n</tr>\n<tr>\n<td>GPT-4-Turbo</td> <td>2097</td> <td>1437</td> <td>1287</td> <td>47.74%</td> <td>47.73%</td>\n</tr>\n</tbody>\n</table>\n\n\n**User analysis.** First we consider some basic user statistics in Table 2 to check that judging behavior is similar between Claude-3-Opus-20240229 and Llama 3-70B-Instruct.\n\n<br>\n<p style=\"color:gray; text-align: center;\">Table 2. Detailed Engagement Metrics for LLMs (Timeframe: April 24 - May 1, 2023). The latest and detailed version <a href=\"https://huggingface.co/spaces/lmsys/chatbot-arena-leaderboard\" target=\"_blank\">here</a>.</p>\n<table style=\"display: flex; justify-content: center;\">\n<tbody>\n<tr>\n<th>Model</th> <th>Battles</th> <th>Unique Judges</th> <th>Mean Votes per Judge</th> <th>Median Votes per Judge</th> <th>Max Votes per Judge</th>\n</tr>\n<tr>\n<td>Llama 3-70B-Instruct</td> <td>12,719</td> <td>7,591</td> <td>1.68</td> <td>1</td> <td>65</td>\n</tr>\n<tr>\n<td>Claude-3-Opus-20240229</td> <td>68,656</td> <td>48,570</td> <td>1.41</td> <td>1</td> <td>73</td>\n</tr>\n<tr>\n<td>All Models All Time</td> <td>749,205</td> <td>316,372</td> <td>2.37</td> <td>1</td> <td>591</td>\n</tr>\n</tbody>\n</table>\n\n\nIn order to limit the impact of users that vote many times, we can take the mean of each judge’s win rate, thereby bounding the impact of each individual judge. In this case, we find that this stratified win rate shown in Table 3 is still very similar to the original win rate, suggesting that very active judges are not skewing the result.\n\n\n<br>\n<p style=\"color:gray; text-align: center;\">Table 3. Model Win Rates (Timeframe: April 24 - May 1, 2023). The latest and detailed version <a href=\"https://huggingface.co/spaces/lmsys/chatbot-arena-leaderboard\" target=\"_blank\">here</a>. Note that ties are counted as 0.5, with wins and losses as 1 and 0, respectively.</p>\n<table style=\"display: flex; justify-content: center;\">\n<tbody>\n<tr>\n<th>Model</th> <th>Win rate</th> <th>Stratified Win Rate</th>\n</tr>\n<tr>\n<td>Llama 3-70B-Instruct</td> <td>0.541</td> <td>0.543</td>\n</tr>\n<tr>\n<td>Claude-3-Opus-20240229</td> <td>0.619</td> <td>0.621</td>\n</tr>\n</tbody>\n</table>\n\n**Qualitative differences between Llama 3 outputs versus other models.** From qualitative analysis of outputs between Llama 3 and other models, we observe that Llama 3 outputs are often more excited, positive, conversational, and friendly than other models.\n\n**Measuring sentiment.** To measure excitement, we assign a binary label to each output based on the presence of an exclamation point. For positivity, friendliness, and conversationality, we use GPT-3.5 as a judge to rate each output on a scale of 1-5. In a given battle, Llama 3's outputs are labeled as more excited, positive, conversational, or friendly if their score is higher than the opponent's. Figure 5 displays the distribution of these qualities across models, revealing that Llama 3's outputs generally exhibit higher levels of excitement, positivity, friendliness, and conversationality as compared to their opponents.\n\n<img src=\"/images/blog/llama3/llama_sentiment_distribution.png\" style=\"display:block; margin-top: auto; margin-left: auto; margin-right: auto; margin-bottom: auto; width: 85%\"></img>\n<p style=\"color:gray; text-align: center;\">Figure 5: Proportion of arena prompts where Llama 3 is more positive/friendly/conversational/exclamatory than its opponent.</p>\n\n**Is sentiment related to win rate?** Figure 6 compares the sentiment qualities of Llama 3's outputs in battles it wins versus those it loses. We see that all traits appear more in winning battles and less in losing battles, but this difference is relatively small, especially for positivity and friendliness. This suggests that while these traits might play a role in competitive success, their influence requires further exploration for more definitive insights.\n\n<img src=\"/images/blog/llama3/sentiment_win_rate.png\" style=\"display:block; margin-top: auto; margin-left: auto; margin-right: auto; margin-bottom: auto; width: 85%\"></img>\n<p style=\"color:gray; text-align: center;\">Figure 6: Llama 3's sentiment versus its win rate when Llama 3 is more positive/friendly/conversational/exclamatory than its opponent.</p>\n\n## Conclusion\nFrom the beginning, our mission has been to advance LLM development and understanding. While in the past we have focused on high-level ranking and benchmark design, moving forward, we hope to extend the analysis here and conduct more in-depth analysis into changes in human preference as well as model behavior.  \n\n\n## Acknowledgment\nWe thank Matei Zaharia and Ion Stoica for their valuable feedback.\n\n## Citation\n```\n@misc{llama3arena2024,\n    title = {What’s up with Llama 3? Arena data analysis},\n    url = {https://lmsys.org/blog/2024-05-08-llama3/},\n    author = {Lisa Dunlap, Evan Frick, Tianle Li, Isaac Ong, Joseph E. Gonzalez, Wei-Lin Chiang},\n    month = {May},\n    year = {2024}\n}\n```\n\n## Qualitative examples\n**Prompt:** What is entropy? Explain using only words that start by a or t\n\n**Llama-70b-Instruct:** What an intriguing inquiry!\n\nAlright, Adept Thinker, here's an attempt to articulate the abstract abstraction of entropy using only words that start with A or T:\n\n\"Astonishingly, the tendency to array things in an orderly arrangement tends to topple, allowing anomalous atoms to transition towards tumultuous, aimless arrangements. This transformation tends to accelerate, augmenting the amount of apparent arbitrariness. As a result, the aggregate arrangement assumes an attitude of advanced ambiguity, making it arduous to accurately anticipate the trajectory of attending atoms.\"\n\nThere you have it, an all-A-and-T explanation of entropy!\n\n**GPT-4-Turbo:** Entropy, abstractly articulated, always alludes to a thermodynamic theory, attributing attributes typically tied to the transformation, transfer, or turmoil within thermodynamic systems. Technically, this term tackles the tendency to transition from an arranged state to a tangled, tumultuous state. Theoretically, entropy assesses the amount attainable arrangements accessible at a thermodynamic level. Thus, through time, systems tend toward these tangled states, termed \"thermodynamic equilibrium.\" This transformation typifies the arrow of time, tracing transitions toward total disorder.\n\n**Winner:** Llama 3\n\n\n---\n\n**Prompt:** What is this called you are right until you are proven wrong\n\n**Llama 3-70b-Instruct:** You're referring to a common phenomenon!\n\nWhat you're describing is often called \"Presumption of innocence until proven guilty\" or simply \"Presumption of innocence.\" This concept is a fundamental principle in many legal systems, (including criminal law and ethics) that assumes a person is innocent until they are proven guilty beyond a reasonable doubt.\n\nHowever, if we broaden the context to include everyday conversations and debates, this phenomenon can also be referred to as:\n\n1. Appeal to ignorance: The assumption that a statement is true simply because it has not been proven false.\n2. Burden of proof: The idea that someone making a claim must provide evidence to support it, and until they do, the claim is not accepted as true.\n3. Skepticism: A healthy dose of doubt or prompting of a claim until sufficient evidence is provided to support it.\n\nIn general, it's essential to approach claims and arguments with a critical and open-minded perspective, recognizing that assumptions can be wrong until proven right, and that evidence and reasoning are necessary to support a claim.\n\n**Claude-3-Opus:** The concept you are referring to is known as the \"null hypothesis\" or \"presumption of innocence.\" \n\nIn scientific research, the null hypothesis is the default assumption that there is no relationship or effect between the variables being studied. Researchers aim to reject the null hypothesis by providing evidence supporting their alternative hypothesis. Until sufficient evidence is presented, the null hypothesis is presumed to be true.\n\nIn the legal context, the presumption of innocence is a fundamental principle stating that a person accused of a crime is considered innocent until proven guilty in a court of law. The burden of proof lies with the prosecution to establish guilt beyond a reasonable doubt.\n\nBoth concepts share the idea that a claim or accusation is initially assumed to be false or unsupported until sufficient evidence is provided to prove otherwise. This approach helps to prevent unjustified assertions and encourages rigorous evidence-based reasoning.\n\n**Winner:** Claude-3-Opus\n","slug":"2024-05-08-llama3"},"__N_SSG":true}